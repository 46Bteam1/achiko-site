<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://thymeleaf.org"
  xmlns:sec="http://thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Achiko</title>
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}" />

    <!-- Google Fonts Ï∂îÍ∞Ä (CORS ÏÑ§Ï†ï Ï∂îÍ∞Ä) -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&display=swap"
      crossorigin="anonymous"
    />

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
      crossorigin="anonymous"
    />

    <!-- JavaScript -->
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script th:src="@{/js/index.js}" defer></script>

    <!-- google map -->
    <script
      async
      defer
      th:src="@{|https://maps.googleapis.com/maps/api/js?key=${googleApiKey}&libraries=places&callback=initMap&language=ja|}"
    ></script>

    <!-- <script th:inline="javascript">
      window.googleApiKeyFromServer = /*[[${googleApiKey}]]*/ "";
    </script> -->
  </head>

  <body>
    <!-- Ìó§Îçî header -->
    <header th:replace="~{fragments/headerTest :: header}"></header>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† main -->
    <main>
      <article class="near-trip">
        <section id="listings-container" class="listings-grid">
          <div
            class="listing-card"
            th:each="listing, iterStat : ${shareList}"
            th:classappend="${(isSubscribed == null or isSubscribed == '') and iterStat.index >= 5} ? 'blur-effect' : ''"
          >
            <a
              th:href="@{/share/selectOne(shareId=${listing.shareId})}"
              class="listing-link"
            >
              <!-- Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÏóê Îî∞Î•∏ Ï∞ú Î≤ÑÌäº -->
              <th:block th:if="${isLoggedIn}">
                <button
                  class="favorite-btn"
                  th:attr="data-id=${listing.shareId}"
                  th:classappend="${listing.isFavorite} ? ' active' : ''"
                >
                  <i
                    th:class="${listing.isFavorite} ? 'fas fa-heart' : 'far fa-heart'"
                  ></i>
                </button>
              </th:block>
              <th:block th:unless="${isLoggedIn}">
                <button
                  class="favorite-btn disabled"
                  title="Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§."
                  disabled
                >
                  <i class="far fa-heart"></i>
                </button>
              </th:block>

              <!-- Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ -->
              <th:block
                th:if="${listing.fileList != null and listing.fileList.size() > 0}"
              >
                <img
                  th:src="${listing.fileList[0].fileUrl}"
                  class="roomImg"
                  alt="Ïù¥ÎØ∏ÏßÄ"
                />
              </th:block>
              <th:block
                th:unless="${listing.fileList != null and listing.fileList.size() > 0}"
              >
                <img
                  src="/images/default-profile.png"
                  class="roomImg"
                  alt="Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ"
                />
              </th:block>

              <!-- Î∞© Ï†ïÎ≥¥ ÏòÅÏó≠ -->
              <div class="listing-info">
                <h3 th:text="${listing.title}"></h3>
                <div class="host-info">
                  <!-- ÏÉÅÌÉúÏóê Îî∞Îùº Îã§Î•∏ ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä -->
                  <div
                    class="status-label"
                    th:text="${listing.status == 'open' ? 'Î™®ÏßëÏ§ë' : (listing.status == 'living' ? 'Í±∞Ï£ºÏ§ë' : 'ÎßàÍ∞ê')}"
                    th:classappend="${listing.status == 'open' ? 'status-open' :
                        (listing.status == 'living' ? 'status-living' : 'status-closed')}"
                  ></div>

                  <!-- Ìò∏Ïä§Ìä∏ Ïù¥ÎØ∏ÏßÄ -->
                  <div class="host-image-wrapper">
                    <img
                      th:src="${listing.hostDTO.profileImage != null ? listing.hostDTO.profileImage : '/images/default-profile.png'}"
                      alt="hostImage"
                      class="host-image"
                    />
                  </div>

                  <div class="host-detail">
                    <span th:text="${listing.hostDTO.nickname}"></span>
                    <span
                      th:text="${listing.hostDTO.avgRating == 0.0 ? '‚≠ê ÏïÑÏßÅ Î¶¨Î∑∞Í∞Ä ÏóÜÎäî Ìò∏Ïä§Ìä∏ÏûÖÎãàÎã§' : '‚≠ê ' + #numbers.formatDecimal(listing.hostDTO.avgRating, 1, 2)}"
                    ></span>
                  </div>
                </div>
                <div class="detail-wrapper">
                  <i class="fas fa-map-marker-alt icon-gray"></i>
                  <p
                    class="text-ellipsis"
                    th:text="${listing.regionName + ' ' + listing.cityName + ' ' + listing.townName}"
                  ></p>
                </div>
                <div class="detail-wrapper">
                  <i class="fas fa-yen-sign icon-gray"></i>
                  <p class="text-ellipsis">
                    <span
                      th:text="${#numbers.formatInteger(listing.price, 3, 'COMMA')}"
                    ></span>
                    / Ïõî
                  </p>
                </div>
                <div class="detail-wrapper">
                  <i class="fas fa-user icon-gray"></i>
                  <p
                    class="text-ellipsis"
                    th:text="'Ïù∏Ïõê: ' + ${listing.currentGuests} + ' / ' + ${listing.maxGuests} + 'Î™Ö'"
                  ></p>
                </div>
              </div>
            </a>
          </div>
        </section>
      </article>

      <!-- google map (Íµ¨Í∏Ä Îßµ) -->
      <article id="mapContainer" style="display: none">
        <div id="googleMap"></div>
      </article>
      <button id="mapButton">üå∏ÏßÄÎèÑ ÌëúÏãúÌïòÍ∏∞üå∏</button>
    </main>

    <!-- Ìë∏ÌÑ∞ -->
    <footer th:replace="~{fragments/footerTest :: footer}"></footer>
  </body>
</html>
