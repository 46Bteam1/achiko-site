<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Achiko</title>
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" th:href="@{/css/review/reviewPage.css}" />

    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />

    <!-- ÌïÑÏöîÌïú ÎùºÏù¥Î∏åÎü¨Î¶¨ (jQuery, Bootstrap JS Îì±) -->
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <!-- Bootstrap JSÎ•º review.jsÎ≥¥Îã§ Î®ºÏ†Ä Î°úÎìú -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>

    <!-- review.jsÎäî defer ÏÜçÏÑ±ÏúºÎ°ú Î°úÎìú -->
    <script th:src="@{/js/review/review.js}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <!-- Ìó§Îçî header -->
    <header th:replace="~{fragments/header :: header}"></header>

    <main class="container mt-4">
      <div class="review-container">
        <!-- ÏÇ¨Ïö©Ïûê Ïπ¥Îìú ÏòÅÏó≠ -->
        <aside class="user-container">
          <div class="user-card">
            <div
              class="user-role-badge"
              th:text="${reviewedUser.isHost == 0 ? 'Í≤åÏä§Ìä∏' : (reviewedUser.isHost == 1 ? 'Ìò∏Ïä§Ìä∏' : 'Í¥ÄÎ¶¨Ïûê')}"
            ></div>
            <img
              th:src="${reviewedUser.profileImage} ?: '/images/default-profile.png'"
              alt="Profile Image"
              class="profile-img"
            />
            <h3 th:text="${reviewedUser.nickname}"></h3>
            <p th:text="${reviewedUser.bio}"></p>
            <div class="user-info">
              <div class="user-info-item">
                <i class="fas fa-globe"></i>
                <span class="label">Íµ≠Ï†Å</span>
                <span
                  class="value"
                  th:text="${reviewedUser.nationality}"
                ></span>
              </div>

              <div class="user-info-item">
                <i class="fas fa-user"></i>
                <span class="label">ÏÑ±Î≥Ñ</span>
                <span
                  class="value"
                  th:text="${reviewedUser.gender == 0 ? 'ÎÇ®ÏÑ±' : (reviewedUser.gender == 1 ? 'Ïó¨ÏÑ±' : 'Í∏∞ÌÉÄ')}"
                ></span>
              </div>

              <div class="user-info-item">
                <i class="fas fa-language"></i>
                <span class="label">ÏÇ¨Ïö© Ïñ∏Ïñ¥</span>
                <div class="languages-container">
                  <th:block th:each="lang : ${languageList}">
                    <img
                      th:src="${lang.flag}"
                      class="flag-icon"
                      th:alt="${lang.name}"
                    />
                  </th:block>
                </div>
              </div>

              <div class="user-info-item">
                <i class="fas fa-praying-hands"></i>
                <span class="label">Ï¢ÖÍµê</span>
                <span class="value" th:text="${reviewedUser.religion}"></span>
              </div>
            </div>

            <div class="rating-box">
              <div class="rating-item">
                <i class="fas fa-broom"></i>
                <span>Ï≤≠Í≤∞ÎèÑ:</span>
                <span
                  th:text="|${averageCleanliness == 0 ? 0 : #numbers.formatDecimal(averageCleanliness, 1, 2)}Ï†ê|"
                ></span>
              </div>
              <div class="rating-item">
                <i class="fas fa-shield-alt"></i>
                <span>Ïã†Î¢∞ÎèÑ:</span>
                <span
                  th:text="|${averageTrust == 0 ? 0 : #numbers.formatDecimal(averageTrust, 1, 2)}Ï†ê|"
                ></span>
              </div>
              <div class="rating-item">
                <i class="fas fa-comments"></i>
                <span>ÏÜåÌÜµ:</span>
                <span
                  th:text="|${averageCommunication == 0 ? 0 : #numbers.formatDecimal(averageCommunication, 1, 2)}Ï†ê|"
                ></span>
              </div>
              <div class="rating-item">
                <i class="fas fa-handshake"></i>
                <span>Îß§ÎÑà:</span>
                <span
                  th:text="|${averageManner == 0 ? 0 : #numbers.formatDecimal(averageManner, 1, 2)}Ï†ê|"
                ></span>
              </div>
            </div>
          </div>

          <div class="user-actions mt-3">
            <button
              class="write-review-btn"
              id="writeReviewBtn"
              th:data-url="@{/review/reviewRegist}"
              th:data-reviewed-user-id="${reviewedUser.userId}"
              th:data-login-user-id="${loginUserId}"
            >
              ‚úç Î¶¨Î∑∞ ÏûëÏÑ±
            </button>
            <button id="shareButton" class="btn-kakao">
              <img
                src="/images/kakaotalk_share.png"
                alt="Ïπ¥Ïπ¥Ïò§ÌÜ° Í≥µÏú†"
                class="kakao-icon"
              />
              Í≥µÏú†ÌïòÍ∏∞
            </button>
          </div>
        </aside>

        <!-- Î¶¨Î∑∞ Î™©Î°ù ÏòÅÏó≠ -->
        <section class="review-list-container">
          <!-- Thymeleaf Îç∞Ïù¥ÌÑ∞Î•º JavaScriptÎ°ú Ï†ÑÎã¨ÌïòÍ∏∞ ÏúÑÌïú hidden ÏöîÏÜåÎì§ -->
          <p
            id="cleanlinessRating"
            th:text="${#numbers.formatDecimal(averageCleanliness, 1, 2) ?: 0}"
            hidden
          ></p>
          <p
            id="trustRating"
            th:text="${#numbers.formatDecimal(averageTrust, 1, 2) ?: 0}"
            hidden
          ></p>
          <p
            id="communicationRating"
            th:text="${#numbers.formatDecimal(averageCommunication, 1, 2) ?: 0}"
            hidden
          ></p>
          <p
            id="mannerRating"
            th:text="${#numbers.formatDecimal(averageManner, 1, 2) ?: 0}"
            hidden
          ></p>

          <div
            class="review-header d-flex justify-content-between align-items-center"
          >
            <h2>ÌõÑÍ∏∞ <span th:text="|Ï¥ù ${#lists.size(reviews)}Í∞ú|"></span></h2>
            <!-- <select id="reviewFilter" class="form-select w-auto">
              <option value="latest" selected>ÏµúÏã†Ïàú</option>
              <option value="oldest">Ïò§ÎûòÎêúÏàú</option>
              <option value="rating">Î≥ÑÏ†êÏàú</option>
            </select> -->
          </div>

          <div class="review-list" id="reviewList">
            <div th:fragment="reviewListFragment">
              <div
                class="review-card"
                th:id="|review-${review.reviewId}|"
                th:each="review : ${reviews}"
              >
                <div class="review-left">
                  <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ -->
                  <img
                    class="reviewer-img"
                    th:src="${review.reviewerDTO.profileImage}"
                    alt="ÌîÑÎ°úÌïÑ"
                  />

                  <!-- Î¶¨Î∑∞ ÎÇ¥Ïö© -->
                  <div class="review-content">
                    <!-- ÏÉÅÎã® ÏòÅÏó≠: ÏûëÏÑ±Ïûê + ÎÇ†Ïßú (Ïö∞Ï∏° Ï†ïÎ†¨) -->
                    <div class="review-header">
                      <p class="review-name">
                        <span th:text="${review.reviewerDTO.nickname}"></span>
                      </p>
                      <p class="review-meta">
                        <span
                          th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}"
                        ></span>
                      </p>
                    </div>

                    <!-- Î¶¨Î∑∞ Î≥∏Î¨∏ -->
                    <p class="review-text" th:text="${review.comment}"></p>

                    <!-- Î≥ÑÏ†ê -->
                    <div class="review-ratings">
                      <div class="each-ratings">
                        <span><strong>Ï≤≠Í≤∞ÎèÑ</strong></span>
                        <div class="stars">
                          <span
                            th:utext="${'‚òÖ'.repeat(review.cleanlinessRating)}"
                          ></span>
                          <span
                            class="gray-stars"
                            th:utext="${'‚òÖ'.repeat(5 - review.cleanlinessRating)}"
                          ></span>
                        </div>
                      </div>

                      <div class="each-ratings">
                        <span><strong>Ïã†Î¢∞ÎèÑ</strong></span>
                        <div class="stars">
                          <span
                            th:utext="${'‚òÖ'.repeat(review.trustRating)}"
                          ></span>
                          <span
                            class="gray-stars"
                            th:utext="${'‚òÖ'.repeat(5 - review.trustRating)}"
                          ></span>
                        </div>
                      </div>

                      <div class="each-ratings">
                        <span><strong>ÏÜåÌÜµ</strong></span>
                        <div class="stars">
                          <span
                            th:utext="${'‚òÖ'.repeat(review.communicationRating)}"
                          ></span>
                          <span
                            class="gray-stars"
                            th:utext="${'‚òÖ'.repeat(5 - review.communicationRating)}"
                          ></span>
                        </div>
                      </div>

                      <div class="each-ratings">
                        <span><strong>Îß§ÎÑà</strong></span>
                        <div class="stars">
                          <span
                            th:utext="${'‚òÖ'.repeat(review.mannerRating)}"
                          ></span>
                          <span
                            class="gray-stars"
                            th:utext="${'‚òÖ'.repeat(5 - review.mannerRating)}"
                          ></span>
                        </div>
                      </div>
                    </div>

                    <!-- ÌïòÎã® ÏòÅÏó≠: ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº (Ïö∞Ï∏° Ï†ïÎ†¨) -->
                    <th:block
                      th:if="${loggedUserId == review.reviewerDTO.userId}"
                    >
                      <div class="review-actions">
                        <a
                          th:href="@{/review/reviewUpdate(reviewId=${review.reviewId})}"
                          class="btn btn-sm btn-outline-primary"
                          >ÏàòÏ†ï</a
                        >
                        <button
                          class="btn btn-sm btn-outline-danger delete-review"
                          th:data-review-id="${review.reviewId}"
                        >
                          ÏÇ≠Ï†ú
                        </button>
                      </div>
                    </th:block>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Í≥µÏú†ÌïòÍ∏∞ Î™®Îã¨ -->
    <div id="shareModal" class="modal">
      <div class="modal-content">
        <span id="closeShareModalBtn" class="close">&times;</span>
        <h4>
          <img
            th:src="@{/images/review/kakaotalk.png}"
            alt="Ïπ¥Ïπ¥Ïò§ÌÜ° Î°úÍ≥†"
            width="26"
            height="26"
            style="
              vertical-align: middle;
              margin-right: 8px;
              border-radius: 5px;
            "
          />
          Í≥µÏú†ÌïòÍ∏∞
        </h4>

        <p style="font-size: 14px; color: gray">
          Ïù¥ ÌéòÏù¥ÏßÄÏùò URLÏùÑ Î≥µÏÇ¨ÌïòÍ±∞ÎÇò SNSÎ°ú Í≥µÏú†ÌïòÏÑ∏Ïöî.
        </p>

        <!-- URL Î≥µÏÇ¨ ÏûÖÎ†•Ï∞Ω -->
        <div class="copy-container">
          <input type="text" id="shareUrl" readonly />
          <button id="copyUrlButton">üìã Î≥µÏÇ¨</button>
        </div>

        <!-- Ïπ¥Ïπ¥Ïò§ Í≥µÏú† Î≤ÑÌäº -->
        <button id="kakaoShareButton" class="btn-kakao">
          üì¢ Ïπ¥Ïπ¥Ïò§ÌÜ° Í≥µÏú†
        </button>
      </div>
    </div>

    <!-- Ìë∏ÌÑ∞ -->
    <footer th:replace="~{fragments/footerTest :: footer}"></footer>
  </body>
</html>
