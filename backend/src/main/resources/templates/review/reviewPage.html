<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>ë¦¬ë·° ëª©ë¡</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script th:src="@{/js/review/review.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .review-summary {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .rating-box {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 16px;
      font-weight: bold;
    }

    .review-card {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 15px;
      background-color: #ffffff;
      border-radius: 10px;
      border: 1px solid #ddd;
      margin-bottom: 10px;
    }

    .review-left {
      display: flex;
      align-items: flex-start;
    }

    .reviewer-img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 15px;
    }

    .review-content {
      flex-grow: 1;
    }

    .review-name {
      font-weight: bold;
    }

    .review-meta {
      font-size: 14px;
      color: gray;
    }

    .stars {
      color: #ffcc00;
    }

    .review-ratings {
      text-align: right;
      min-width: 120px;
      font-weight: bold;
    }

    .review-ratings p {
      margin: 2px 0;
    }

    .write-review-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 12px 18px;
      font-size: 16px;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
    }

    .write-review-btn:hover {
      background-color: #0056b3;
    }

    /* ğŸ”¹ ëª¨ë‹¬ì°½ ìŠ¤íƒ€ì¼ */
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      width: 360px;
      /* í¬ê¸° ì¦ê°€ */
      max-height: 300px;
      /* í•œëˆˆì— ë‹¤ ë³´ì´ê²Œ */
      text-align: center;
      overflow: hidden;
    }

    /* ğŸ”¹ ëª¨ë‹¬ ë‚´ë¶€ ì»¨í…ì¸  */
    .modal-content {
      position: relative;
      padding: 15px;
    }

    /* ğŸ”¹ ë‹«ê¸° ë²„íŠ¼ */
    .close {
      position: absolute;
      top: 10px;
      right: 12px;
      font-size: 20px;
      cursor: pointer;
    }

    /* ğŸ”¹ URL ë³µì‚¬ ì…ë ¥ì°½ */
    .copy-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
      margin: 12px 0;
      border: 1px solid #ddd;
    }

    .copy-container input {
      width: 80%;
      border: none;
      background: transparent;
      font-size: 14px;
      outline: none;
      padding: 5px;
    }

    /* ğŸ”¹ ë³µì‚¬ ë²„íŠ¼ (í¬ê¸° í‚¤ì›€) */
    .copy-container button {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 18px;
      /* ê°€ë¡œ í­ ì¦ê°€ */
      cursor: pointer;
      border-radius: 6px;
      font-size: 14px;
      font-weight: bold;
      white-space: nowrap;
      /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
    }

    .copy-container button:hover {
      background: #0056b3;
    }

    /* ğŸ”¹ ì¹´ì¹´ì˜¤ ê³µìœ  ë²„íŠ¼ */
    .btn-kakao {
      width: 100%;
      padding: 12px;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      background: #ffeb3b;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
    }

    .btn-kakao:hover {
      background: #fdd835;
    }
  </style>

</head>

<body>
  <div class="container mt-4">
    <h3 class="mt-3 text-start">
      <span th:text="${reviewedUserName}"></span>ë‹˜ì— ëŒ€í•œ í›„ê¸° <span class="text-muted" style="font-size: 14px;">
        (<span th:text="${isHost == 0 ? 'ê²ŒìŠ¤íŠ¸' : (isHost == 1 ? 'í˜¸ìŠ¤íŠ¸' : 'ê´€ë¦¬ì')}"></span>
        Â· <span th:text="${nationality}"></span> Â· <span
          th:text="${gender == 0 ? 'ë‚¨ì„±' : (gender == 1 ? 'ì—¬ì„±' : 'ê¸°íƒ€')}"></span>
        Â· <span th:text="${languages}"></span> Â· <span th:text="${religion}"></span>)
      </span>
    </h3>

    <!-- â­ ì°¨íŠ¸ ì¶”ê°€ -->
    <div class="chart-container">
      <canvas id="reviewDonutChart"></canvas>
    </div>

    <!-- Thymeleafì—ì„œ ë°ì´í„°ë¥¼ JavaScriptë¡œ ë„˜ê²¨ì£¼ëŠ” hidden ìš”ì†Œ -->
    <p id="cleanlinessRating" th:text="${#numbers.formatDecimal(averageCleanliness, 1, 2) ?: 0}" hidden></p>
    <p id="trustRating" th:text="${#numbers.formatDecimal(averageTrust, 1, 2) ?: 0}" hidden></p>
    <p id="communicationRating" th:text="${#numbers.formatDecimal(averageCommunication, 1, 2) ?: 0}" hidden></p>
    <p id="mannerRating" th:text="${#numbers.formatDecimal(averageManner, 1, 2) ?: 0}" hidden></p>


    <button id="ShareButton" class="btn btn-outline-secondary ms-3">ê³µìœ í•˜ê¸°</button>

    <div class="d-flex justify-content-end mb-3">
      <select id="reviewFilter" class="form-select w-auto">
        <option value="latest" selected>ìµœì‹ ìˆœ</option>
        <option value="oldest">ì˜¤ë˜ëœìˆœ</option>
        <option value="rating">ë³„ì ìˆœ</option>
      </select>
    </div>

    <p class="text-muted" style="font-size: 14px;" th:text="${bio}"></p>

    <div class="review-summary">
      Â· í›„ê¸° <span th:text="|ì´ ${#lists.size(reviews)}ê°œ|"></span>
    </div>
    <div class="rating-box">
      <div>
        <p>ì²­ê²°ë„</p>
        <p th:text="${#numbers.formatDecimal(averageCleanliness, 1, 2)}"></p>
      </div>
      <div>
        <p>ì‹ ë¢°ë„</p>
        <p th:text="${#numbers.formatDecimal(averageTrust, 1, 2)}"></p>
      </div>
      <div>
        <p>ì†Œí†µ ëŠ¥ë ¥</p>
        <p th:text="${#numbers.formatDecimal(averageCommunication, 1, 2)}"></p>
      </div>
      <div>
        <p>ë§¤ë„ˆ</p>
        <p th:text="${#numbers.formatDecimal(averageManner, 1, 2)}"></p>
      </div>
    </div>

    <!-- ê¸°ì¡´ ì½”ë“œì—ì„œ ì¶”ê°€ -->
    <div id="reviewList">
      <div th:fragment="reviewListFragment">
        <div class="review-card d-flex justify-content-between align-items-center" th:id="|review-${review.reviewId}|"
          th:each="review : ${reviews}">

          <!-- ì™¼ìª½ (ë¦¬ë·° ì •ë³´) -->
          <div class="review-left d-flex align-items-start">
            <img class="reviewer-img" th:src="@{/images/default-profile.png}" alt="í”„ë¡œí•„">
            <div class="review-content">
              <p class="review-name">ë¦¬ë·° ì‘ì„±ì: <span th:text="${review.reviewerId}"></span></p>
              <p class="review-meta">
                <span th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}"></span>
              </p>
              <p class="review-text" th:text="${review.comment}"></p>
              <div class="d-flex mt-2">
                <a th:href="@{/review/reviewUpdate(reviewId=${review.reviewId})}"
                  class="btn btn-sm btn-outline-primary me-2">ìˆ˜ì •</a>
                <button class="btn btn-sm btn-outline-danger delete-review"
                  th:data-review-id="${review.reviewId}">ì‚­ì œ</button>

              </div>
            </div>
          </div>

          <!-- ğŸ”¹ ì˜¤ë¥¸ìª½ (ì ìˆ˜) -->
          <div class="review-scores text-end">
            <p><strong>ì²­ê²°ë„</strong> <span th:text="${review.cleanlinessRating}"></span></p>
            <p><strong>ì‹ ë¢°ë„</strong> <span th:text="${review.trustRating}"></span></p>
            <p><strong>ì†Œí†µ</strong> <span th:text="${review.communicationRating}"></span></p>
            <p><strong>ë§¤ë„ˆ</strong> <span th:text="${review.mannerRating}"></span></p>
          </div>

        </div>
      </div>
    </div>
  </div>


  <button class="write-review-btn" onclick="location.href='/review/reviewRegist?reviewedUserId=15'">âœ
    ë¦¬ë·° ì‘ì„±</button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ê³µìœ í•˜ê¸° ëª¨ë‹¬ -->
  <div id="shareModal" class="modal">
    <div class="modal-content">
      <span id="closeShareModalBtn" class="close">&times;</span>
      <h4>
        <img th:src="@{/images/review/kakaotalk.png}" alt="ì¹´ì¹´ì˜¤í†¡ ë¡œê³ " width="26" height="26"
          style="vertical-align: middle; margin-right: 8px; border-radius: 5px;">
        ê³µìœ í•˜ê¸°
      </h4>




      <p style="font-size: 14px; color: gray;">ì´ í˜ì´ì§€ì˜ URLì„ ë³µì‚¬í•˜ê±°ë‚˜ SNSë¡œ ê³µìœ í•˜ì„¸ìš”.</p>

      <!-- URL ë³µì‚¬ ì…ë ¥ì°½ -->
      <div class="copy-container">
        <input type="text" id="shareUrl" readonly>
        <button id="copyUrlButton">ğŸ“‹ ë³µì‚¬</button>
      </div>

      <!-- ì¹´ì¹´ì˜¤ ê³µìœ  ë²„íŠ¼ -->
      <button id="kakaoShareButton" class="btn-kakao">ğŸ“¢ ì¹´ì¹´ì˜¤í†¡ ê³µìœ </button>
    </div>
  </div>



</body>

</html>